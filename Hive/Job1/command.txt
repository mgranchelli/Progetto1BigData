hive --f ./job1.hql


Inizializzare il DB all'interno della cartella:
rm -rf metastore_db 
schematool -dbType derby -initSchema

CREATE TABLE years_text (year INT, text STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';

LOAD DATA LOCAL INPATH ''/Users/manuelgranchelli/Universit√†/BigData/Progetti/Progetto1BigData/Hive/Job1/test_10_record.txt'' OVERWRITE INTO TABLE years_text;

chmod 777 ./year_words.py

ADD FILE ./year_words.py;

CREATE TABLE output AS
SELECT TRANSFORM(years_text.year, years_text.text)
USING 'python3 year_words.py' AS year, word, count
FROM years_text
GROUP BY years_text.year;

SELECT year, word, count(*) as number 
FROM output 
GROUP BY year, word ORDER BY year, number desc limit 10;

SELECT year, word, number
FROM (
    SELECT year, word, number, row_number() 
           over (PARTITION BY year ORDER BY year, number DESC) as rank 
    FROM (SELECT year, word, count(*) as number 
FROM output 
GROUP BY year, word ORDER BY year) out1 ORDER BY year DESC, number DESC) ranked_scores
where rank <= 10
