Inizializzare il DB all'interno della cartella:
rm -rf metastore_db 
schematool -dbType derby -initSchema

CREATE TABLE products_users_score (productId STRING, userId STRING, score INT) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';

LOAD DATA LOCAL INPATH './test_30_record.txt' OVERWRITE INTO TABLE products_users_score;

CREATE TABLE output AS
SELECT userId, productId, score
FROM products_users_score
GROUP BY userId, productId, score
ORDER BY userId


SELECT userId, productId, score
FROM (
    SELECT userId, productId, row_number() 
           over (PARTITION BY userId, score ORDER BY score DESC) as rank, score
    FROM products_users_score
) ranked_mytable
WHERE ranked_mytable.rank < 2
ORDER BY userId





SELECT userId, productId, score
FROM (
    SELECT userId, productId, rank(score) as rank, score
    FROM products_users_score
    DISTRIBUTE BY userId, productId
    SORT BY userId, productId, score desc
) a 
WHERE rank < 5
ORDER BY page-id, rank

